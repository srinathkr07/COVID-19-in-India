---
title: "COVID-19 in India"
output: 
  flexdashboard::flex_dashboard:
    vertical_layout:  fill
    social: ["twitter", "facebook", "linkedin"]
    theme: readable
runtime: shiny
---

```{r setup, include=FALSE}

library(flexdashboard)
library(rjson)
library(DT)
library(plotly)
library(lubridate)
library(ggplot2)
library(ggiraph)
library(geojsonio)
library(colormap) 
library(hrbrthemes) 

result = fromJSON(file = "https://api.covid19india.org/data.json")

india = data.frame(matrix(ncol = 5, nrow = 0))
colnames(india) = c("State/UT", "Confirmed", "Active", "Recovered", "Death")

for (i in 2:38)
  if(as.numeric(result$statewise[[i]]$confirmed)>0)
    india[nrow(india)+1, ] = list(result$statewise[[i]]$state, 
                                as.numeric(result$statewise[[i]]$confirmed), 
                                as.numeric(result$statewise[[i]]$active), 
                                as.numeric(result$statewise[[i]]$recovered), 
                                as.numeric(result$statewise[[i]]$deaths))

india = india[order(-india[, 2]), ]

totalConfirmed = as.numeric(result$statewise[[1]]$confirmed)
totalActive = as.numeric(result$statewise[[1]]$active)
totalRecovered = as.numeric(result$statewise[[1]]$recovered)
totalDeath = as.numeric(result$statewise[[1]]$deaths)

copy = data.frame(india)
names(copy)[names(copy) == "State.UT"] <- "id"

shape = geojsonio::geojson_read("india-polygon.geojson", what = "sp")
states <- fortify(shape, region = "ST_NM")

merged_shape = merge(states, copy, by = "id", all.x = TRUE)
final_plot = merged_shape[order(merged_shape$order), ]
final_plot[is.na(final_plot)] = 0


daily = data.frame(matrix(ncol = 7, nrow = 0))
colnames(daily) = c("Date", "DailyConfirmed", "DailyRecovered", "DailyDeath", "TotalConfirmed", "TotalRecovered", "TotalDeath")

for(i in 1:length(result$cases_time_series))
  daily[nrow(daily)+1, ] = list(format(as.Date(paste(trimws(result$cases_time_series[[i]]$date), "2020"), format = "%d %B %y"), "%d %b %Y"),
                                as.numeric(result$cases_time_series[[i]]$dailyconfirmed),
                                as.numeric(result$cases_time_series[[i]]$dailyrecovered),
                                as.numeric(result$cases_time_series[[i]]$dailydeceased),
                                as.numeric(result$cases_time_series[[i]]$totalconfirmed),
                                as.numeric(result$cases_time_series[[i]]$totalrecovered),
                                as.numeric(result$cases_time_series[[i]]$totaldeceased))

```

Summary {data-orientation=rows data-icon="fa-list-alt"}
===========

Row{}
----------------------

### Total Confirmed cases

```{r}
valueBox(value = paste(format(totalConfirmed, big.mark = ","), "", sep = " "), icon = "fa-check-circle")
```

### Total Active cases

```{r}
valueBox(value = paste(format(totalActive, big.mark = ","), "", sep = " "), icon = "fa-toggle-on")
```

### Total Recovered

```{r}
valueBox(value = paste(format(totalRecovered, big.mark = ","), "", sep = " "), icon = "fa-heartbeat")
```

### Total Deaths

```{r}
valueBox(value = paste(format(totalDeath, big.mark = ","), "", sep = " "), icon = "fa-bed")
```

Row {}
-----------------------------------------------------------------------

### State wise details

```{r}

india %>%
  DT::datatable(rownames = FALSE,
                colnames = colnames(india),
                options = list(pageLength = nrow(india), dom = 'tip'))

```


Visualization {data-icon="fa-bar-chart"}
==========

Column
------------------------

### State-wise distribution of cases

```{r}

india$`State/UT` <- factor(india$`State/UT`, levels = unique(india$`State/UT`)[order(india$Confirmed, decreasing = TRUE)])

plotly::plot_ly(data = india,
                x = india$`State/UT`,
                y = india$Active, 
                type = "bar", 
                name = "Active",
                marker = list(color = "#1f77b4")) %>%
  
  plotly::add_trace(y = india$Recovered, 
                    name = "Recovered",
                    marker = list(color = "forestgreen")) %>%
    
  plotly::add_trace(y = india$Death, 
                    name = "Death",
                    marker = list(color = "red")) %>%
  
  plotly::layout(barmode = 'stack',
                 yaxis = list(title = "Total Cases"),
                 xaxis = list(title = ""), 
                 hovermode = "compare",
                  margin =  list(
                   b = 10,
                   t = 10,
                   pad = 2
                 ),
                 legend = list(x = 0.1, y = 1.4))

```

Column {}
-----------------------------------------------------------------------

### India map

```{r}

renderggiraph({
  
  g <- ggplot(final_plot) +
  geom_polygon_interactive(
    color='black', size = 0.3, 
    aes(x = long, y = lat, group = group, fill = Confirmed,
        tooltip = sprintf("State/UT: %s <br> Confirmed: %s <br> Active: %s <br> Recovered: %s <br> Death(s): %s", id, Confirmed, Active, Recovered, Death))) +
  guides(fill=guide_legend("No. of cases")) +
  hrbrthemes::theme_ipsum() +
  colormap::scale_fill_colormap(
    colormap=colormap::colormaps$copper, reverse = T) +
  labs(title='Total cases in India', subtitle = "Hover over a state for more details")

  girafe_options(ggiraph(code = print(g), width_svg = 12, height_svg = 12))
})

```

Trends {data-orientation=rows data-icon="fa-chart-line"}
==========

Row {.tabset}
-------------------

### Cumulative

```{r}

daily$Date = dmy(daily$Date)

# plotly::plot_ly(data = daily) %>%
#   
#   plotly::add_trace(x = daily$Date , 
#                     y = daily$TotalConfirmed,
#                     type = "scatter",
#                     mode = "lines+markers",
#                     name = "Confirmed",
#                     line = list(color = "#1f77b4"),
#                     marker = list(color = "#1f77b4")) %>%
# 
#   plotly::add_trace(x = daily$Date , 
#                     y = daily$TotalRecovered,
#                     type = "scatter",
#                     mode = "lines+markers",
#                     name = "Recovered",
#                     line = list(color = "forestgreen"),
#                     marker = list(color = "forestgreen")) %>%
#   
#   plotly::add_trace(x = daily$Date , 
#                     y = daily$TotalDeath,
#                     type = "scatter",
#                     mode = "lines+markers",
#                     name = "Death",
#                     line = list(color = "red"),
#                     marker = list(color = "red")) %>%
#   
#   plotly::layout(title = "",
#                  yaxis = list(title = "Cumulative cases"),
#                  xaxis = list(title = "Date"),
#                  legend = list(x = 0.1, y = 0.9),
#                  hovermode = "compare")

plotly::plot_ly(data = daily,
                x = daily$Date,
                y = daily$TotalConfirmed, 
                name = 'Confirmed', 
                fillcolor = "#1f77b4",
                type = 'scatter',
                mode = 'none', 
                stackgroup = 'one') %>%
  
  plotly::add_trace(y = daily$TotalRecovered,
                    name = "Recovered",
                    fillcolor = "forestgreen") %>%
  
  plotly::add_trace(y = daily$TotalDeath,
                    name = "Death",
                    fillcolor = "red") %>%
  
  plotly::layout(title = "",
                 yaxis = list(title = "Cumulative Number of Cases"),
                 xaxis = list(title = "Date"),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "compare")

```

### Daily

```{r}

#daily$Date = dmy(daily$Date)

plotly::plot_ly(data = daily) %>%
  
  plotly::add_trace(x = daily$Date , 
                    y = daily$DailyConfirmed,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Confirmed",
                    line = list(color = "#1f77b4"),
                    marker = list(color = "#1f77b4")) %>%

  plotly::add_trace(x = daily$Date , 
                    y = daily$DailyRecovered,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Recovered",
                    line = list(color = "forestgreen"),
                    marker = list(color = "forestgreen")) %>%
  
  plotly::add_trace(x = daily$Date , 
                    y = daily$DailyDeath,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Death",
                    line = list(color = "red"),
                    marker = list(color = "red")) %>%
  
  plotly::layout(title = "",
                 yaxis = list(title = "Daily cases"),
                 xaxis = list(title = "Date"),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "compare")

```

About {data-icon="fa-question-circle"}
==========

**COVID-19 in India : A Dashboard**

This dashboard gives an overview of the spread of the Novel Coronavirus (COVID-19) pandemic across India, state-wise. 
This dashboard has been made entirely using Rmarkdown framework.

**Data:**

[COVID-19 India API](https://api.covid19india.org/), a volunteer-driven API for COVID-19 stats & patient tracing in India.

**R packages used:**

* Dashboard - [flexdashboard](https://rmarkdown.rstudio.com/flexdashboard/) package.

* Table - [DT](https://rstudio.github.io/DT/) package.

* API Data - [rjson](https://www.rdocumentation.org/packages/rjson/versions/0.2.20) package.

* Visualizations - [plotly](https://plot.ly/r/), [ggplot2](https://ggplot2.tidyverse.org/), [geojsonio](https://ropensci.org/tutorials/geojsonio_tutorial/), [ggiraph](https://davidgohel.github.io/ggiraph/), [colormap](https://bhaskarvk.github.io/colormap/) and [hrbrthemes](https://hrbrmstr.github.io/hrbrthemes/) packages. 

**Note:**

For any other question or feedback, you can contact me on [LinkedIn](https://www.linkedin.com/in/srinath-kr-026147173/).

**Acknowledgement:**

Thanks for the API, [COVID-19 India API](https://api.covid19india.org/)! 

**Created by [Srinath K R](https://github.com/srinathkr07).**  
