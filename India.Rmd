---
title: "COVID-19 in India"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    social: menu
    theme: readable
runtime: shiny
---

```{r setup, include=FALSE}

library(flexdashboard)
library(rvest)
library(magrittr)
library(xml2)
library(stringr)
library(ggplot2)
library(ggiraph)
library(geojsonio)
library(colormap) 
library(hrbrthemes) 

url = "https://www.mohfw.gov.in/"

page = read_html(url, as.data.frame=T, stringsAsFactors = TRUE)

page %>%  
  html_nodes("table") %>% 
  .[[1]] %>% 
  html_table(fill=T) -> india

# Removing S.no column
india = india[, -1]
# Removing the last row (Total no. of cases)
india = head(india, -1)

# Renaming the columns of the table
colnames(india) = c("State/UT", "Confirmed", "Recovered", "Death")

# Changing the format for each of the column 
india$`State/UT` = as.character(india$`State/UT`)
india$Confirmed = as.numeric(india$Confirmed)
india$Recovered = as.numeric(india$Recovered)
india$Death = as.numeric(india$Death)

# Arrange by the confirmed cases in descending order
india = india[order(-india[, 2]), ]
india$`State/UT`[which(india$`State/UT` == "Telengana")] = "Telangana"

copy = data.frame(india)
names(copy)[names(copy) == "State.UT"] <- "id"

shape = geojsonio::geojson_read("india-polygon.geojson", what = "sp")
states <- fortify(shape, region = "ST_NM")

merged_shape = merge(states, copy, by = "id", all.x = TRUE)
final_plot = merged_shape[order(merged_shape$order), ]
final_plot[is.na(final_plot)] = 0

```

Stats and Visualization
=====

Column {}
-----------------------------------------------------------------------

### State wise details

```{r}

india %>%
  DT::datatable(rownames = FALSE,
                colnames = colnames(india),
                options = list(pageLength = nrow(india), dom = 'tip'))

```

Column {}
-----------------------------------------------------------------------

### Map visualization

```{r}

renderggiraph({
  
  g <- ggplot(final_plot) +
  geom_polygon_interactive(
    color='black', size = 0.3, 
    aes(x = long, y = lat, group = group, fill = Confirmed+Recovered+Death,
        tooltip = sprintf("State/UT: %s <br> Confirmed: %s <br> Active: %s <br> Recovered: %s <br> Death(s): %s", id, Confirmed, Confirmed-Recovered-Death, Recovered, Death))) +
  guides(fill=guide_legend("No. of cases")) +
  hrbrthemes::theme_ipsum() +
  colormap::scale_fill_colormap(
    colormap=colormap::colormaps$copper, reverse = T) +
  labs(title='Total cases in India', subtitle = "Hover over a state for more details")

  girafe_options(ggiraph(code = print(g), width_svg = 12, height_svg = 12))
})

```

About {data-orientation=rows}
==========

**COVID-19 in India : A Dashboard**

This simple dashboard gives an overview of the spread of the Novel Coronavirus COVID-19 pandemic across India, state-wise. 
This dashboard has been made entirely using Rmarkdown framework.

**Data source**

[Ministry of Health and Family Welfare, India](https://www.mohfw.gov.in/).

**R packages used **

* Dashboard - [flexdashboard](https://rmarkdown.rstudio.com/flexdashboard/) package.

* Table - [dplyr](https://dplyr.tidyverse.org/), [tidyr](https://tidyr.tidyverse.org/) and [DT](https://rstudio.github.io/DT/) packages.

* Scraping - [rvest](http://rvest.tidyverse.org/), [magrittr](https://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html), [xml2](https://xml2.r-lib.org/) and [stringr](https://stringr.tidyverse.org/) packages.

* Map Visualization - [ggplot2](https://ggplot2.tidyverse.org/), [geojsonio](https://ropensci.org/tutorials/geojsonio_tutorial/), [ggiraph](https://davidgohel.github.io/ggiraph/), [colormap](https://bhaskarvk.github.io/colormap/) and [hrbrthemes](https://hrbrmstr.github.io/hrbrthemes/) packages. 

**Note**

Since the data is scraped from [Ministry of Health and Family Welfare, India](https://www.mohfw.gov.in/) and **the format of the page is changed often**, one might not be able to see the stats and visualisation, if the page format doesn't match with the one I have coded for. I'll look for changes daily, if any and try to fix them. 

For any question or feedback, you can contact me on [LinkedIn](https://www.linkedin.com/in/srinath-kr-026147173/). 